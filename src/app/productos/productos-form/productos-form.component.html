<div class="container mt-4">
  <div class="card shadow-sm p-4"
    style="background-color: #ffe4ec; border-radius: 12px; animation: fadeInUp 0.8s ease both;">
    <h2 class="mb-4 text-center" style="color: #d16ba5;">
      {{ id ? 'Editar Producto' : 'Nuevo Producto' }}
    </h2>

    <div *ngIf="isLoading" class="text-center">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Cargando...</span>
      </div>
    </div>

    <form *ngIf="!isLoading" [formGroup]="productoForm" (ngSubmit)="guardar()">
      
      <div class="mb-3">
        <label for="nombre" class="form-label">Nombre</label>
        <input type="text" id="nombre" class="form-control campo-suave" 
               formControlName="nombre"
               [class.is-invalid]="f.nombre.invalid && f.nombre.touched" />
        <div *ngIf="f.nombre.invalid && f.nombre.touched" class="invalid-feedback">
          <span *ngIf="f.nombre.errors?.['required']">El nombre es requerido.</span>
          <span *ngIf="f.nombre.errors?.['minlength']">Debe tener al menos 3 caracteres.</span>
        </div>
      </div>

      <div class="mb-3">
        <label for="precio" class="form-label">Precio</label>
        <input type="number" id="precio" class="form-control campo-suave"
               formControlName="precio"
               [class.is-invalid]="f.precio.invalid && f.precio.touched" />
        <div *ngIf="f.precio.invalid && f.precio.touched" class="invalid-feedback">
          <span *ngIf="f.precio.errors?.['required']">El precio es requerido.</span>
          <span *ngIf="f.precio.errors?.['min']">El precio debe ser mayor a 0.</span>
        </div>
      </div>
      
      <div class="mb-3">
        <label for="tipoProducto" class="form-label">Tipo Producto</label>
        <select id="tipoProducto" class="form-select campo-suave" 
                formControlName="tipoProducto"
                [class.is-invalid]="f.tipoProducto.invalid && f.tipoProducto.touched">
          <option [ngValue]="null" disabled>Seleccione un tipo</option>
          <option *ngFor="let unidad of tipoProductoOpciones" [ngValue]="unidad.id">
            {{ unidad.nombre }}
          </option>
        </select>
        <div *ngIf="f.tipoProducto.invalid && f.tipoProducto.touched" class="invalid-feedback">
          El tipo de producto es requerido.
        </div>
      </div>

      <div class="mb-3">
        <label for="idImagen" class="form-label">Imagen (Opcional)</label>
        <select id="idImagen" class="form-select campo-suave" 
                formControlName="idImagen">
          <option [ngValue]="null">-- Sin Imagen --</option>
          <option *ngFor="let unidad of imagenesOpciones" [ngValue]="unidad.id">
            {{ unidad.nombre }}
          </option>
        </select>
        </div>

      <div class="mb-3">
        <label for="descripcion" class="form-label">Descripción</label>
        <input type="text" id="descripcion" class="form-control campo-suave" 
               formControlName="descripcion"
               [class.is-invalid]="f.descripcion.invalid && f.descripcion.touched" />
        <div *ngIf="f.descripcion.invalid && f.descripcion.touched" class="invalid-feedback">
          La descripción es requerida.
        </div>
      </div>

      <div *ngIf="errorMessage" class="alert alert-danger mt-3">
        {{ errorMessage }}
      </div>

      <div class="d-flex justify-content-center mt-4">
        <button class="btn btn-sm me-2 btn-rosa-secondary" type="submit" 
                [disabled]="productoForm.invalid || isSaving">
          <span *ngIf="!isSaving">
            <i class="bi bi-check-circle"></i> Guardar
          </span>
          <span *ngIf="isSaving" class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
        </button>
        <a class="btn btn-sm btn-rosa-primary" routerLink="/productos">
          <i class="bi bi-x-circle"></i> Cancelar
        </a>
      </div>
    </form>
  </div>
</div>